from fastapi import FastAPI, HTTPException, Request
from typing import Callable, Dict

app = FastAPI()


def handle_create(data: dict) -> None:
    # бизнес-логика создания
    pass


def handle_update(data: dict) -> None:
    # бизнес-логика обновления
    pass


def handle_delete(data: dict) -> None:
    # бизнес-логика удаления
    pass


ACTION_WHITELIST: Dict[str, Callable[[dict], None]] = {
    "create": handle_create,
    "update": handle_update,
    "delete": handle_delete,
}


@app.post("/webhook")
async def webhook(request: Request) -> dict:
    payload = await request.json()

    action = payload.get("action")
    if action not in ACTION_WHITELIST:
        raise HTTPException(status_code=400, detail="Unsupported action")

    handler = ACTION_WHITELIST[action]
    handler(payload)

    return {"status": "ok"}
