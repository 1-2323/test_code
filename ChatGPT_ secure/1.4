from fastapi import FastAPI, Depends, HTTPException, status
from sqlalchemy.orm import Session

app = FastAPI()

# ---- Примеры зависимостей и моделей ----

class User:
    def __init__(self, is_admin: bool):
        self.is_admin = is_admin

def get_current_user() -> User:
    # В реальном проекте здесь будет логика авторизации (JWT, session и т.д.)
    return User(is_admin=True)  # пример

def get_db():
    # вернуть сессию БД
    ...

class Comment:
    id: int

# ---- Эндпоинт ----

@app.delete("/comments/{comment_id}", status_code=status.HTTP_204_NO_CONTENT)
def delete_comment(
    comment_id: int,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_user),
):
    # Проверка роли
    if not current_user.is_admin:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="Доступ разрешён только администраторам",
        )

    comment = db.query(Comment).filter(Comment.id == comment_id).first()
    if not comment:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Комментарий не найден",
        )

    db.delete(comment)
    db.commit()

    return None
