from fastapi import APIRouter, HTTPException, Depends, status
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, delete
from database import get_db  # Предполагается наличие генератора сессий
from models import Comment   # Предполагается наличие модели SQLAlchemy

router = APIRouter()

@router.delete("/comments/{comment_id}", status_code=status.HTTP_204_NO_CONTENT)
async def delete_comment(
    comment_id: int, 
    db: AsyncSession = Depends(get_db)
):
    # Поиск комментария для проверки его существования
    query = select(Comment).where(Comment.id == comment_id)
    result = await db.execute(query)
    comment = result.scalar_one_or_none()

    if not comment:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"Comment with id {comment_id} not found"
        )

    # Удаление комментария
    delete_stmt = delete(Comment).where(Comment.id == comment_id)
    await db.execute(delete_stmt)
    await db.commit()
    
    return None
