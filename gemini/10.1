import requests
import uuid

def check_license(api_url, license_key):
    """
    Проверяет валидность лицензионного ключа через API.
    
    :param api_url: URL вашего сервера лицензирования
    :param license_key: Строка с ключом пользователя
    :return: (bool, str) - Статус и сообщение
    """
    
    # Рекомендуется передавать HWID (Hardware ID), чтобы лицензию не копировали
    hwid = str(uuid.getnode())
    
    payload = {
        "license_key": license_key,
        "hwid": hwid
    }
    
    try:
        # Устанавливаем таймаут, чтобы программа не зависла при плохом соединении
        response = requests.post(api_url, json=payload, timeout=10)
        
        # Проверяем HTTP статус (200, 404, 500 и т.д.)
        response.raise_for_status()
        
        data = response.json()
        
        # Логика обработки ответа сервера
        if data.get("status") == "success":
            return True, "Лицензия активна. Доступ разрешен."
        else:
            reason = data.get("message", "Неизвестная ошибка")
            return False, f"Лицензия недействительна: {reason}"
            
    except requests.exceptions.Timeout:
        return False, "Ошибка: Сервер проверки не отвечает (Timeout)."
    except requests.exceptions.ConnectionError:
        return False, "Ошибка: Отсутствует подключение к интернету."
    except requests.exceptions.HTTPError as e:
        return False, f"Ошибка сервера: {e.response.status_code}"
    except Exception as e:
        return False, f"Произошла непредвиденная ошибка: {e}"

# --- Пример использования ---
SERVER_URL = "https://api.your-service.com/v1/verify"
USER_KEY = "ABCD-1234-EFGH-5678"

is_valid, message = check_license(SERVER_URL, USER_KEY)

if is_valid:
    print(f"✅ {message}")
    # Здесь запускается основной код программы
else:
    print(f"❌ {message}")
