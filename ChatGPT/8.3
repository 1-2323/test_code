from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
from typing import Any, Dict
import threading

app = FastAPI()

_config_lock = threading.Lock()
_config: Dict[str, Any] = {}

class UpdatePayload(BaseModel):
    config: Dict[str, Any]

@app.post("/update")
def update_config(payload: UpdatePayload):
    with _config_lock:
        _config.clear()
        _config.update(payload.config)
    return {"status": "ok"}
