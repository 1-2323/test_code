from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
import requests

app = FastAPI()

LLM_API_URL = "https://api.external-llm.com/generate"
LLM_API_KEY = "API_KEY"


class GenerateRequest(BaseModel):
    text: str


@app.post("/generate")
def generate(payload: GenerateRequest):
    if not payload.text.strip():
        raise HTTPException(status_code=400, detail="Empty text")

    prompt = f"Продолжи или обработай следующий пользовательский текст:\n{payload.text}"

    response = requests.post(
        LLM_API_URL,
        headers={"Authorization": f"Bearer {LLM_API_KEY}"},
        json={"prompt": prompt},
        timeout=10,
    )

    if response.status_code != 200:
        raise HTTPException(status_code=502, detail="LLM service error")

    data = response.json()
    return {"result": data.get("text")}
