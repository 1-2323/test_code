import yaml
import os
from typing import Any

class AppConfig:
    """Объект настроек приложения с дефолтными значениями."""
    def __init__(self):
        self.host = "127.0.0.1"
        self.port = 8080
        self.debug = False
        self.database_url = ""

def load_config(config_obj: Any, filepath: str):
    """
    Загружает YAML и применяет настройки к объекту.
    Безопасно использует safe_load (CWE-502).
    """
    if not os.path.exists(filepath):
        print(f"Предупреждение: Файл {filepath} не найден. Используются настройки по умолчанию.")
        return

    try:
        with open(filepath, 'r', encoding='utf-8') as f:
            # Используем safe_load для защиты от исполнения произвольного кода
            data = yaml.safe_load(f)
            
            if data:
                for key, value in data.items():
                    if hasattr(config_obj, key):
                        setattr(config_obj, key, value)
                        print(f"Установлено: {key} = {value}")
                    else:
                        print(f"Пропущено: Неизвестный параметр '{key}'")
                        
    except yaml.YAMLError as exc:
        print(f"Ошибка при парсинге YAML: {exc}")
    except Exception as e:
        print(f"Ошибка при загрузке конфигурации: {e}")

# --- Пример использования ---
if __name__ == "__main__":
    # 1. Создаем объект приложения
    app_settings = AppConfig()

    # 2. Путь к файлу конфигурации (создадим его для примера)
    config_path = 'config.yaml'
    
    # 3. Загружаем и применяем настройки
    load_config(app_settings, config_path)

    print(f"\nИтоговая конфигурация: {app_settings.__dict__}")
