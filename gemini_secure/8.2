import json
import os
from typing import Any, Dict, Optional

class DataRestorer:
    """
    Класс для безопасной десериализации данных.
    Использует только безопасные форматы (JSON), исключая pickle.
    """

    @staticmethod
    def from_json(file_path: str) -> Dict[str, Any]:
        """Восстановление данных из JSON-файла."""
        if not os.path.exists(file_path):
            raise FileNotFoundError(f"Файл не найден: {file_path}")
            
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                return json.load(f)
        except json.JSONDecodeError as e:
            raise ValueError(f"Ошибка формата JSON: {e}")

    @classmethod
    def restore(cls, file_path: str) -> Dict[str, Any]:
        """
        Универсальный метод восстановления. 
        Определяет формат по расширению файла.
        """
        extension = os.path.splitext(file_path)[1].lower()
        
        if extension == '.json':
            return cls.from_json(file_path)
        elif extension == '.pkl' or extension == '.pickle':
            # Явный отказ от обработки небезопасных форматов
            raise SecurityError("Использование pickle запрещено (CWE-502).")
        else:
            raise ValueError(f"Формат {extension} не поддерживается.")

class SecurityError(Exception):
    """Исключение для нарушений безопасности данных."""
    pass

# Пример использования:
# data = DataRestorer.restore("backup.json")
